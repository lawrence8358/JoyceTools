# æ½®æ±è³‡æ–™æå–å™¨ Chrome æ“´å……åŠŸèƒ½

## ğŸ“‹ å°ˆæ¡ˆæ¦‚è¿°

ç”±æ–¼æ½®æ±è³‡æ–™ç¶²ç«™ (zh.tideschart.com) å•Ÿç”¨äº† Cloudflare é˜²çˆ¬èŸ²é©—è­‰æ©Ÿåˆ¶ï¼ŒåŸæœ‰çš„è‡ªå‹•çˆ¬èŸ²æ–¹æ¡ˆå¤±æ•ˆã€‚æœ¬å°ˆæ¡ˆæä¾›äº†ä¸€å€‹ Chrome æ“´å……åŠŸèƒ½è§£æ±ºæ–¹æ¡ˆï¼Œå…è¨±ä½¿ç”¨è€…æ‰‹å‹•è¨ªå•ç¶²ç«™ä¸¦æå–æ½®æ±è³‡æ–™ï¼Œç„¶å¾Œé€é **ç›´æ¥ API ä¸Šå‚³** æˆ– JSON æª”æ¡ˆåŒ¯å…¥åˆ°è³‡æ–™åº«ä¸­ã€‚

## ğŸ¯ åŠŸèƒ½ç‰¹é»

- âœ… ç¹é Cloudflare äººæ©Ÿé©—è­‰
- âœ… å‹å¥½çš„åœ–å½¢ä»‹é¢æ“ä½œ
- âœ… è‡ªå‹•è­˜åˆ¥ç•¶å‰è¨ªå•çš„åœ°é»
- âœ… æ™ºæ…§è¡¨æ ¼è­˜åˆ¥èˆ‡è³‡æ–™æå–
- âœ… **ç›´æ¥ä¸Šå‚³åˆ°é ç«¯è³‡æ–™åº«** (v1.5.0 æ–°åŠŸèƒ½)
- âœ… **API ç¶²å€å¯è‡ªè¨‚è¨­å®š** (v1.5.0 æ–°åŠŸèƒ½)
- âœ… **æ“·å–ç‹€æ…‹è‡ªå‹•ä¿ç•™** (v1.5.0 æ–°åŠŸèƒ½)
- âœ… ä¸€éµåŒ¯å‡ºæ¨™æº– JSON æ ¼å¼
- âœ… æ‰¹æ¬¡åŒ¯å…¥è³‡æ–™åº«
- âœ… åŸºæœ¬éŒ¯èª¤æç¤ºèˆ‡æ—¥èªŒ

## ğŸ“ å°ˆæ¡ˆçµæ§‹

```
TideDataExtractor/             # Chrome æ“´å……åŠŸèƒ½å°ˆæ¡ˆ
â”œâ”€â”€ manifest.json              # æ“´å……åŠŸèƒ½è¨­å®šæª”ï¼ˆManifest V3ï¼‰
â”œâ”€â”€ popup.html                 # æ“´å……åŠŸèƒ½å½ˆå‡ºä»‹é¢
â”œâ”€â”€ popup.js                   # ä¸»ç¨‹å¼å…¥å£ï¼ˆäº‹ä»¶å”èª¿ï¼‰
â”œâ”€â”€ config.js                  # è¨­å®šç®¡ç†ï¼ˆé è¨­ APIã€åœ°é»æ¸…å–®ï¼‰
â”œâ”€â”€ storage.js                 # Chrome Storage ç®¡ç†ï¼ˆç‹€æ…‹æŒä¹…åŒ–ï¼‰
â”œâ”€â”€ extractor.js               # è³‡æ–™æå–é‚è¼¯ï¼ˆå–®ä¸€/æ‰¹æ¬¡æå–ï¼‰
â”œâ”€â”€ api.js                     # API é€šè¨Šæ¨¡çµ„
â”œâ”€â”€ ui.js                      # UI äº’å‹•ç®¡ç†
â”œâ”€â”€ content.js                 # é é¢å…§å®¹æå–è…³æœ¬ï¼ˆæ³¨å…¥é é¢ï¼‰
â”œâ”€â”€ cors-test.html             # CORS æ¸¬è©¦å·¥å…·ï¼ˆç¨ç«‹ç¶²é ï¼‰
â”œâ”€â”€ Example/                   # ç¯„ä¾‹ JSON æª”æ¡ˆ
â”‚   â””â”€â”€ tide_data_all_20251225.json
â””â”€â”€ icons/                     # æ“´å……åŠŸèƒ½åœ–ç¤º
    â”œâ”€â”€ icon16.png
    â”œâ”€â”€ icon48.png
    â””â”€â”€ icon128.png

WebApp/
â”œâ”€â”€ Controllers/
â”‚   â””â”€â”€ TideController.cs      # æ½®æ± API æ§åˆ¶å™¨ï¼ˆå« Import ç«¯é»ï¼‰
â”œâ”€â”€ Models/
â”‚   â”œâ”€â”€ TideModel.cs           # æŸ¥è©¢æ¨¡å‹
â”‚   â””â”€â”€ TideImportModel.cs     # åŒ¯å…¥æ¨¡å‹
â””â”€â”€ Program.cs                 # CORS è¨­å®šï¼ˆåƒ…å…è¨± Chrome æ“´å……å’Œ localhostï¼‰


UnitTest/
â”œâ”€â”€ TideImportApiTest.cs       # API åŒ¯å…¥å–®å…ƒæ¸¬è©¦
â”œâ”€â”€ CorsTest.cs                # CORS æ”¿ç­–å–®å…ƒæ¸¬è©¦
â””â”€â”€ TestData/
    â””â”€â”€ tide_data_test.json    # æ¸¬è©¦ç”¨ JSON è³‡æ–™
```

## ğŸš€ å¿«é€Ÿé–‹å§‹

### æ­¥é©Ÿ 1ï¼šå®‰è£ Chrome æ“´å……åŠŸèƒ½

1. é–‹å•Ÿ Chrome ç€è¦½å™¨
2. è¨ªå• `chrome://extensions/`
3. é–‹å•Ÿå³ä¸Šè§’çš„ã€Œé–‹ç™¼äººå“¡æ¨¡å¼ã€
4. é»æ“Šã€Œè¼‰å…¥æœªå°è£é …ç›®ã€
5. é¸æ“‡ `TideDataExtractor` è³‡æ–™å¤¾
6. æ“´å……åŠŸèƒ½å®‰è£æˆåŠŸå¾Œæœƒé¡¯ç¤ºåœ¨å·¥å…·åˆ—

### æ­¥é©Ÿ 2ï¼šå•Ÿå‹• WebApp API æœå‹™ï¼ˆå¦‚éœ€ç›´æ¥ä¸Šå‚³ï¼‰

```bash
cd WebApp
dotnet run
```

é è¨­æœƒåœ¨ `http://localhost:5000` å•Ÿå‹•æœå‹™

### æ­¥é©Ÿ 3ï¼šæå–ä¸¦ä¸Šå‚³æ½®æ±è³‡æ–™

#### æ–¹æ³• Aï¼šä¸€æ¬¡æå–å…¨éƒ¨åœ°é»ä¸¦ç›´æ¥ä¸Šå‚³ï¼ˆæ¨è–¦ï¼‰

1. é»æ“Šæ“´å……åŠŸèƒ½åœ–ç¤º
2. ç¢ºèª API ç¶²å€è¨­å®šæ­£ç¢ºï¼ˆé è¨­: `http://localhost:5000`ï¼‰
3. é»æ“Šã€ŒğŸ“¦ ä¸€æ¬¡æå–å…¨éƒ¨åœ°é»ã€æŒ‰éˆ•
4. ç³»çµ±æœƒè‡ªå‹•ï¼š
   - é–‹å•Ÿ Sydneyã€Chennaiã€IndianOceanã€Tokyo å››å€‹ç¶²ç«™
   - ä¾åºæå–æ¯å€‹åœ°é»çš„è³‡æ–™
   - é¡¯ç¤ºé€²åº¦ï¼ˆç´„éœ€ 30-40 ç§’ï¼‰
5. å®Œæˆå¾Œé»æ“Šã€Œâ¬†ï¸ ä¸Šå‚³åˆ°è³‡æ–™åº«ã€ç›´æ¥å¯«å…¥é ç«¯è³‡æ–™åº«
   - æˆ–é»æ“Šã€Œâ¬‡ï¸ ä¸‹è¼‰ JSON æª”æ¡ˆã€ä¿å­˜ç‚ºæœ¬åœ°æª”æ¡ˆ

> **æç¤º**: æ“·å–çš„è³‡æ–™æœƒè‡ªå‹•ä¿å­˜ï¼Œå³ä½¿é—œé–‰ popup è¦–çª—ä¹Ÿä¸æœƒéºå¤±ï¼ˆ2 å°æ™‚å…§æœ‰æ•ˆï¼‰

#### æ–¹æ³• Bï¼šæ‰‹å‹•æå–å–®ä¸€åœ°é»

##### æ”¯æ´çš„åœ°é»
| åœ°é» | æ™‚å€ | URL |
|------|------|-----|
| Sydney (é›ªæ¢¨) | UTC+10:30 | https://zh.tideschart.com/Australia/New-South-Wales/Sydney |
| Chennai (æ¸…å¥ˆ) | UTC+5:30 | https://zh.tideschart.com/India/Tamil-Nadu/Chennai |
| Indian Ocean (å°åº¦æ´‹) | UTC+6 | https://zh.tideschart.com/British-Indian-Ocean-Territory |
| Tokyo (æ±äº¬) | UTC+9 | https://zh.tideschart.com/Japan/Tokyo |

##### æ“ä½œæ­¥é©Ÿ
1. é»æ“Šæ“´å……åŠŸèƒ½åœ–ç¤º
2. é¸æ“‡ç›®æ¨™åœ°é»ï¼ˆæˆ–ä½¿ç”¨ã€ŒğŸ”— å‰å¾€ç¶²ç«™ã€æŒ‰éˆ•ç›´æ¥è·³è½‰ï¼‰
3. ç­‰å¾…é é¢å®Œå…¨è¼‰å…¥ï¼ˆå®Œæˆ Cloudflare é©—è­‰ï¼‰
4. é»æ“Šã€ŒğŸ“„ æå–ç•¶å‰é é¢è³‡æ–™ã€æŒ‰éˆ•
5. é»æ“Šã€Œâ¬†ï¸ ä¸Šå‚³åˆ°è³‡æ–™åº«ã€æˆ–ã€Œâ¬‡ï¸ ä¸‹è¼‰ JSON æª”æ¡ˆã€

## ğŸ”Œ API ç«¯é»

### POST /api/Tide/Import

å¾ Chrome æ“´å……åŠŸèƒ½åŒ¯å…¥æ½®æ±è³‡æ–™

#### CORS æ”¿ç­–
WebApp çš„ CORS æ”¿ç­–å·²è¨­å®šç‚ºåƒ…å…è¨±ï¼š
- **Chrome æ“´å……åŠŸèƒ½**: `chrome-extension://`
- **æœ¬åœ°é–‹ç™¼**: `http://localhost`, `https://localhost`

**ç”Ÿç”¢ç’°å¢ƒéƒ¨ç½²æ™‚è«‹å‹™å¿…ä¿®æ”¹** `WebApp/Program.cs` ä¸­çš„ CORS è¨­å®šï¼š

```csharp
builder.Services.AddCors(options =>
{
    options.AddPolicy("ChromeExtensionPolicy", policy =>
    {
        policy.SetIsOriginAllowed(origin => 
            origin.StartsWith("chrome-extension://") ||    // Chrome æ“´å……åŠŸèƒ½
            origin.StartsWith("http://localhost") ||       // æœ¬åœ°æ¸¬è©¦
            origin.StartsWith("https://localhost") ||
            origin.StartsWith("https://your-domain.com")   // åŠ å…¥æ‚¨çš„ç¶²åŸŸ
        )
        .AllowAnyMethod()
        .AllowAnyHeader();
    });
});
```

#### CORS æ¸¬è©¦å·¥å…·
ä½¿ç”¨ `TideDataExtractor/cors-test.html` æ¸¬è©¦ CORS è¨­å®šï¼š
1. å•Ÿå‹• WebApp æœå‹™
2. åœ¨ç€è¦½å™¨ä¸­é–‹å•Ÿ `cors-test.html`
3. è¼¸å…¥ API ç¶²å€ï¼ˆé è¨­ `http://localhost:5000`ï¼‰
4. é»æ“Šæ¸¬è©¦æŒ‰éˆ•é©—è­‰ CORS æ˜¯å¦æ­£ç¢ºè¨­å®š

**è«‹æ±‚æ ¼å¼:**
```json
{
  "extractTime": "2025-12-25T13:30:00.000Z",
  "locations": [
    {
      "name": "Sydney",
      "timezone": 10.5,
      "url": "https://zh.tideschart.com/...",
      "data": [
        {
          "date": "å‘¨äº” 26",
          "tide1": { "time": "01:18", "value": "â–² 1.34 ç±³", "type": "é«˜æ½®" },
          "tide2": { "time": "06:49", "value": "â–¼ 0.65 ç±³", "type": "ä½æ½®" },
          "tide3": { "time": "13:10", "value": "â–² 1.66 ç±³", "type": "é«˜æ½®" },
          "tide4": { "time": "19:55", "value": "â–¼ 0.44 ç±³", "type": "ä½æ½®" }
        }
      ]
    }
  ]
}
```

**å›æ‡‰æ ¼å¼:**
```json
{
  "success": true,
  "importedCount": 7,
  "message": "åŒ¯å…¥å®Œæˆï¼Œå…± 7 ç­†è³‡æ–™",
  "details": [
    "âœ… Sydney: åŒ¯å…¥ 7 ç­†",
    "âœ… Tokyo: åŒ¯å…¥ 7 ç­†"
  ]
}
```

### POST /api/Tide/Query

æŸ¥è©¢å·²å„²å­˜çš„æ½®æ±è³‡æ–™

**è«‹æ±‚æ ¼å¼:**
```json
{
  "sdate": "2025-12-01T00:00:00Z",
  "edate": "2025-12-31T23:59:59Z"
}
```

## ğŸ“Š è³‡æ–™æ ¼å¼

### JSON æª”æ¡ˆçµæ§‹

æ“´å……åŠŸèƒ½æœƒä¿ç•™ HTML åŸå§‹æ ¼å¼ï¼Œè®“å¾Œç«¯è™•ç†æ›´éˆæ´»ï¼š

```json
{
  "extractTime": "2025-12-25T13:30:00.000Z",
  "locations": [
    {
      "name": "Sydney",
      "timezone": 10.5,
      "url": "https://zh.tideschart.com/Australia/New-South-Wales/Sydney",
      "data": [
        {
          "date": "å‘¨äº” 26",
          "tide1": {
            "time": "01:18",
            "value": "â–² 1.34 ç±³",
            "type": "é«˜æ½®"
          },
          "tide2": {
            "time": "06:49",
            "value": "â–¼ 0.65 ç±³",
            "type": "ä½æ½®"
          },
          "tide3": {
            "time": "13:10",
            "value": "â–² 1.66 ç±³",
            "type": "é«˜æ½®"
          },
          "tide4": {
            "time": "19:55",
            "value": "â–¼ 0.44 ç±³",
            "type": "ä½æ½®"
          }
        }
      ]
    }
  ]
}
```

**è³‡æ–™èªªæ˜ï¼š**
| æ¬„ä½ | èªªæ˜ |
|------|------|
| `extractTime` | æå–æ™‚é–“æˆ³ (ISO æ ¼å¼) |
| `locations[]` | å¯åŒ…å«å¤šå€‹åœ°é»çš„è³‡æ–™ |
| `name` | åœ°é»åç¨±ï¼ˆSydney, Chennai, IndianOcean, Tokyoï¼‰ |
| `timezone` | æ™‚å€åç§»é‡ |
| `url` | ä¾†æºç¶²å€ |
| `data[]` | è©²åœ°é»çš„æ¯æ—¥æ½®æ±è³‡æ–™ |
| `date` | æ—¥æœŸï¼ˆä¿ç•™åŸå§‹æ ¼å¼ï¼Œå¦‚"å‘¨äº” 26"ï¼‰ |
| `tide1-4` | å››å€‹æ½®æ±æ™‚æ®µ |
| `time` | æ™‚é–“ï¼ˆå¦‚"01:18"ï¼‰ |
| `value` | é«˜åº¦ï¼ˆä¿ç•™åŸå§‹æ ¼å¼ï¼Œå¦‚"â–² 1.34 ç±³"ï¼‰ |
| `type` | æ½®æ±é¡å‹ï¼ˆ"é«˜æ½®"æˆ–"ä½æ½®"ï¼‰ |

### è³‡æ–™åº«çµæ§‹ (TideEntity)

```csharp
public class TideEntity
{
    // ä¸»éµ: Date + Location
    public DateTime Date { get; set; }
    public string Location { get; set; }
    
    // ç¬¬ä¸€è‡³ç¬¬å››æ½®æ±è³‡æ–™
    public decimal? FirstTideHeight { get; set; }   // æ¼²æ½®ç‚ºæ­£ï¼Œé€€æ½®ç‚ºè² 
    public DateTime? FirstTideTime { get; set; }
    public decimal? SecondTideHeight { get; set; }
    public DateTime? SecondTideTime { get; set; }
    public decimal? ThirdTideHeight { get; set; }
    public DateTime? ThirdTideTime { get; set; }
    public decimal? FourthTideHeight { get; set; }
    public DateTime? FourthTideTime { get; set; }
    
    public DateTime CreatedDate { get; set; }
    public DateTime ModifiedDate { get; set; }
}
```

## ğŸ› ç–‘é›£æ’è§£

### å•é¡Œ 1: "Could not establish connection"

**åŸå› **: æ“´å……åŠŸèƒ½åœ¨é é¢é–‹å•Ÿå¾Œæ‰å®‰è£/æ›´æ–°ï¼Œcontent script æœªæ³¨å…¥

**è§£æ±ºæ–¹æ¡ˆ**:
1. é»æ“Šã€ŒğŸ”„ é‡æ–°æ•´ç†é é¢ã€æŒ‰éˆ•ï¼ˆæˆ–æŒ‰ F5ï¼‰
2. ç­‰å¾…é é¢å®Œå…¨è¼‰å…¥
3. é‡æ–°é»æ“Šæ“´å……åŠŸèƒ½åœ–ç¤º
4. å†æ¬¡å˜—è©¦æå–è³‡æ–™

### å•é¡Œ 2: "æœªèƒ½æå–åˆ°æœ‰æ•ˆçš„æ½®æ±è³‡æ–™"

**åŸå› **: é é¢å°šæœªå®Œå…¨è¼‰å…¥æˆ–è¡¨æ ¼æ ¼å¼è®ŠåŒ–

**è§£æ±ºæ–¹æ¡ˆ**:
1. ç­‰å¾… 8-10 ç§’è®“é é¢å®Œå…¨è¼‰å…¥
2. ç¢ºèªæ‰¾åˆ°çš„è¡¨æ ¼æ•¸é‡å’Œå…§å®¹ï¼Œæˆ–ä½¿ç”¨ç€è¦½å™¨ä¸»æ§å°æª¢æŸ¥éŒ¯èª¤
3. ç¢ºèªæ‰¾åˆ°çš„è¡¨æ ¼æ•¸é‡å’Œå…§å®¹
4. æŒ‰ F12 é–‹å•Ÿé–‹ç™¼è€…å·¥å…·ï¼ŒæŸ¥çœ‹ä¸»æ§å°è¨Šæ¯

### å•é¡Œ 3: API ä¸Šå‚³å¤±æ•—

**æª¢æŸ¥é …ç›®**:
1. ç¢ºèª WebApp æœå‹™å·²å•Ÿå‹•
2. ç¢ºèª API ç¶²å€è¨­å®šæ­£ç¢º
3. æª¢æŸ¥ç¶²è·¯é€£ç·š
4. æŸ¥çœ‹ç€è¦½å™¨é–‹ç™¼è€…å·¥å…· Network åˆ†é 

**CORS è¨­å®š**: WebApp å·²è¨­å®šå…è¨±è·¨åŸŸè«‹æ±‚ï¼Œè‹¥ä»æœ‰å•é¡Œè«‹ç¢ºèª Program.cs ä¸­çš„ CORS è¨­å®š

### å•é¡Œ 4: æ“·å–ä¸­é€”é—œé–‰ popup

**èªªæ˜**: ç³»çµ±æœƒè‡ªå‹•ä¿å­˜æ“·å–ç‹€æ…‹ï¼Œé‡æ–°é–‹å•Ÿ popup æ™‚æœƒæç¤ºæ¢å¾©ä¹‹å‰çš„è³‡æ–™ï¼ˆ2 å°æ™‚å…§æœ‰æ•ˆï¼‰

## ğŸ”§ é€²éšè¨­å®š

### è‡ªè¨‚ API ç¶²å€

1. é–‹å•Ÿæ“´å……åŠŸèƒ½ popup
2. åœ¨ã€ŒAPI ç¶²å€ã€è¼¸å…¥æ¡†ä¸­è¼¸å…¥æ‚¨çš„ API ä½å€
3. è¨­å®šæœƒè‡ªå‹•ä¿å­˜åˆ° chrome.storage

### æ‰¹æ¬¡è™•ç†èˆŠ JSON æª”æ¡ˆ

```csharp
// ä½¿ç”¨ TideJsonImportHelper åŒ¯å…¥æœ¬åœ° JSON æª”æ¡ˆ
var helper = new TideJsonImportHelper(dbContext);
var importedCount = await helper.ImportFromFolder(
    Path.Combine(AppContext.BaseDirectory, "AppData", "TideData")
);
Console.WriteLine($"æ‰¹æ¬¡åŒ¯å…¥å®Œæˆï¼Œå…± {importedCount} ç­†è³‡æ–™");
```

## ğŸ“ æŠ€è¡“ç´°ç¯€

### Chrome æ“´å……åŠŸèƒ½æ¶æ§‹

- **Manifest Version**: 3
- **Permissions**: `activeTab`, `downloads`, `storage`
- **Content Scripts**: åœ¨ zh.tideschart.com ä¸Šè‡ªå‹•æ³¨å…¥
- **Message Passing**: popup.js â†” content.js é€šè¨Š
- **Storage**: ä½¿ç”¨ chrome.storage.local ä¿å­˜ç‹€æ…‹ï¼ˆ2 å°æ™‚æœ‰æ•ˆæœŸï¼‰

#### æ¨¡çµ„åŒ–æ¶æ§‹ (v1.6.0)

ç‚ºæé«˜ç¨‹å¼ç¢¼å¯ç¶­è­·æ€§ï¼Œpopup.js å·²é‡æ§‹ç‚ºæ¨¡çµ„åŒ–æ¶æ§‹ï¼š

| æ¨¡çµ„ | è¡Œæ•¸ | è·è²¬ |
|------|------|------|
| **config.js** | ~30 | é›†ä¸­ç®¡ç†è¨­å®šï¼ˆAPI ç¶²å€ã€åœ°é»è³‡è¨Šï¼‰ |
| **storage.js** | ~70 | Chrome Storage æ“ä½œï¼ˆç‹€æ…‹ä¿å­˜/æ¢å¾©ï¼‰ |
| **extractor.js** | ~160 | æ ¸å¿ƒæå–é‚è¼¯ï¼ˆå–®ä¸€/æ‰¹æ¬¡æå–ï¼‰ |
| **api.js** | ~30 | API é€šè¨Šï¼ˆPOST è«‹æ±‚è™•ç†ï¼‰ |
| **ui.js** | ~100 | UI äº’å‹•ï¼ˆç‹€æ…‹é¡¯ç¤ºã€ä¸‹è¼‰ã€é™¤éŒ¯ï¼‰ |
| **popup.js** | ~260 | ä¸»ç¨‹å¼å…¥å£ï¼ˆäº‹ä»¶å”èª¿ï¼‰ |

**æ¨¡çµ„ä¾è³´é †åº**: config â†’ storage â†’ ui â†’ api â†’ extractor â†’ popup

**è¼‰å…¥æ–¹å¼** (`popup.html`):
```html
<script src="config.js"></script>
<script src="storage.js"></script>
<script src="ui.js"></script>
<script src="api.js"></script>
<script src="extractor.js"></script>
<script src="popup.js"></script>
```

### è³‡æ–™è™•ç†æµç¨‹

```
ä½¿ç”¨è€…è¨ªå•ç¶²ç«™ 
â†’ Cloudflare é©—è­‰ï¼ˆæ‰‹å‹•å®Œæˆï¼‰
â†’ é é¢è¼‰å…¥å®Œæˆ
â†’ content.js æ³¨å…¥
â†’ æå–è¡¨æ ¼è³‡æ–™ï¼ˆä¿ç•™åŸå§‹æ ¼å¼ï¼‰
â†’ çµ„è£ JSON
â†’ ä¿å­˜åˆ° chrome.storage.localï¼ˆ2 å°æ™‚æœ‰æ•ˆï¼‰
â†’ é¸æ“‡ä¸Šå‚³æ–¹å¼:
    A. API ä¸Šå‚³ â†’ POST /api/Tide/Import â†’ CORS é©—è­‰ â†’ å„²å­˜åˆ° SQLite
    B. ä¸‹è¼‰ JSON â†’ æ‰‹å‹•åŒ¯å…¥ â†’ TideJsonImportHelper â†’ SQLite
```

### æ™ºèƒ½ç­‰å¾…æ©Ÿåˆ¶

æ‰¹æ¬¡æå–æ™‚ä½¿ç”¨æ™ºèƒ½ç­‰å¾…ï¼š
1. åŸºæœ¬ç­‰å¾… 8 ç§’ï¼ˆCloudflare é©—è­‰æ™‚é–“ï¼‰
2. æ¯ 2 ç§’æª¢æŸ¥ä¸€æ¬¡è¡¨æ ¼æ˜¯å¦è¼‰å…¥
3. æœ€å¤šé‡è©¦ 5 æ¬¡
4. ç¸½è¨ˆæœ€é•·ç­‰å¾… 18 ç§’

### ç‹€æ…‹æŒä¹…åŒ–

ä½¿ç”¨ `chrome.storage.local` ä¿å­˜ï¼š
- å·²æå–çš„è³‡æ–™
- è‡ªè¨‚ API ç¶²å€
- æ‰¹æ¬¡æå–é€²åº¦

**éæœŸæ©Ÿåˆ¶**: è¶…é 2 å°æ™‚è‡ªå‹•æ¸…é™¤

## ğŸ§ª å–®å…ƒæ¸¬è©¦

### åŸ·è¡Œæ‰€æœ‰æ¸¬è©¦
```bash
cd UnitTest
dotnet test
```

### åŸ·è¡Œç‰¹å®šæ¸¬è©¦å¥—ä»¶

#### æ½®æ±åŒ¯å…¥æ¸¬è©¦
```bash
dotnet test --filter "FullyQualifiedName~TideImportApiTest"
```

æ¸¬è©¦é …ç›®ï¼š
- âœ… JSON æ¨¡å‹è§£æ
- âœ… æ™‚å€è¨­å®šæ­£ç¢ºæ€§
- âœ… æ½®æ±è³‡æ–™è§£æ
- âœ… API Import åŠŸèƒ½
- âœ… è³‡æ–™åº«å¯«å…¥
- âœ… æ½®é«˜æ­£è² è™Ÿè™•ç†
- âœ… å¤šåœ°é»åŒ¯å…¥
- âœ… é‡è¤‡è³‡æ–™æ›´æ–°

#### CORS æ”¿ç­–æ¸¬è©¦
```bash
dotnet test --filter "FullyQualifiedName~CorsTest"
```

æ¸¬è©¦é …ç›®ï¼š
- âœ… Chrome æ“´å……åŠŸèƒ½ä¾†æº (`chrome-extension://`)
- âœ… Localhost ä¾†æº (`http://localhost`)

**æ³¨æ„**: CORS æ¸¬è©¦éœ€è¦ WebApp æœå‹™é‹è¡Œä¸­ï¼Œå¦å‰‡æ¸¬è©¦æœƒè·³é

## ğŸ“œ ç‰ˆæœ¬æ­·å²

| ç‰ˆæœ¬ | æ—¥æœŸ | æ›´æ–°å…§å®¹ |
|------|------|----------|
| v1.0.0 | 2024-01 | åˆå§‹ç‰ˆæœ¬ï¼Œæ”¯æ´ 4 å€‹åœ°é»çš„è³‡æ–™æå– |
| v1.1.0 | 2024-01 | æ–°å¢é€£ç·šéŒ¯èª¤è‡ªå‹•é‡æ–°æ•´ç†æç¤º |
| v1.2.0 | 2024-01 | æ–°å¢é™¤éŒ¯åŠŸèƒ½å’Œæ™ºæ…§è¡¨æ ¼è­˜åˆ¥ |
| v1.3.0 | 2024-01 | è½‰æ›ç‚ºç¹é«”ä¸­æ–‡ï¼Œå„ªåŒ– UI ä¸€è‡´æ€§ |
| v1.4.0 | 2024-01 | æ–°å¢ç•¶å‰é é¢è·³è½‰åŠŸèƒ½ï¼Œæ•´åˆæ–‡ä»¶ |
| v1.5.0 | 2024-12 | **æ–°å¢ API ç›´æ¥ä¸Šå‚³åŠŸèƒ½ã€ç‹€æ…‹ä¿ç•™ã€API ç¶²å€è¨­å®š** |
| v1.6.0 | 2025-01 | **é‡æ§‹ç‚ºæ¨¡çµ„åŒ–æ¶æ§‹ã€ç¸®å° CORS ç¯„åœã€æ–°å¢å–®å…ƒæ¸¬è©¦** |

## ğŸ“§ æ”¯æ´èˆ‡å›é¥‹

å¦‚é‡åˆ°å•é¡Œæˆ–æœ‰æ”¹é€²å»ºè­°ï¼Œè«‹æä¾›ï¼š
1. éŒ¯èª¤è¨Šæ¯æˆªåœ–
2. ç€è¦½å™¨ä¸»æ§å°è¨Šæ¯ (F12)
3. ç›®æ¨™ç¶²ç«™ URL

## ğŸ“„ æˆæ¬Š

æœ¬å°ˆæ¡ˆåƒ…ä¾›å­¸ç¿’å’Œå€‹äººä½¿ç”¨ã€‚è«‹å‹¿ç”¨æ–¼å•†æ¥­ç”¨é€”æˆ–å¤§é‡çˆ¬å–è³‡æ–™ã€‚

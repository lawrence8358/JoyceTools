<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>潮汐資料提取器</title>
  <!-- Bootstrap CSS (本地) -->
  <link rel="stylesheet" href="vendor/bootstrap.min.css">
  <!-- Font Awesome (本地) -->
  <link rel="stylesheet" href="vendor/fontawesome.min.css">
  <link rel="stylesheet" href="popup.css">
</head>

<body>
  <h4 class="mb-2"><img src="icons/icon48.png" alt="icon" class="app-icon"> 潮汐資料提取器</h4>

  <div class="mb-2 small text-muted">當前頁面: <span id="currentUrl">-</span></div>

  <!-- Tabs -->
  <ul class="nav nav-tabs" id="mainTabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="extract-tab" data-bs-toggle="tab" data-bs-target="#extract" type="button"
        role="tab"><i class="fa-solid fa-water me-1"></i><span class="tab-label">提取</span></button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="settings-tab" data-bs-toggle="tab" data-bs-target="#settings" type="button"
        role="tab"><i class="fa-solid fa-gear me-1"></i><span class="tab-label">設定</span></button>
    </li>
  </ul>
  <div class="tab-content mt-3">
    <div class="tab-pane fade show active" id="extract" role="tabpanel">

      <div class="mb-2">
        <label for="location" class="form-label">選擇地點</label>
        <select id="location" class="form-select form-select-sm">
          <option value="Sydney">Sydney (雪梨)</option>
          <option value="Chennai">Chennai (清奈)</option>
          <option value="IndianOcean">Indian Ocean (印度洋)</option>
          <option value="Tokyo">Tokyo (東京)</option>
        </select>
      </div>
      <div class="mb-2">
        <label for="apiUrl" class="form-label">API 網址</label>
        <input type="text" id="apiUrl" class="form-control form-control-sm" placeholder="http://localhost:5000">
      </div>

      <div class="d-flex gap-2 mb-2 equal-width">
        <button id="goToUrlBtn" class="btn btn-sm btn-aux">🔗 前往網站</button>
        <button id="copyUrlBtn" class="btn btn-sm btn-aux">📋 複製網址</button>
      </div>

      <div class="d-grid gap-2 mb-2">
        <button id="reloadPageBtn" class="btn btn-sm btn-warning">🔄 重新整理頁面</button>
      </div>

      <div class="d-flex gap-2 mb-2 equal-width">
        <button id="extractAllBtn" class="btn btn-sm btn-main">📦 一次提取全部地點</button>
        <button id="uploadBtn" class="btn btn-sm btn-backup" disabled>⬆️ 上傳到資料庫</button>
      </div>

      <div class="d-flex gap-2 mb-2 equal-width">
        <button id="extractBtn" class="btn btn-sm btn-main">📄 提取當前頁面資料</button>
        <button id="downloadBtn" class="btn btn-sm btn-backup" disabled>⬇️ 下載 JSON 檔案</button>
      </div>

      <div id="status" class="mt-2"></div>

      <div class="card mt-2">
        <div class="card-body p-2 small">
          <strong>使用說明:</strong>
          <ol class="mb-0">
            <li>在潮汐網站打開對應地點頁面並完成 Cloudflare 驗證。</li>
            <li>點擊「提取當前頁面資料」或「一次提取全部地點」。</li>
            <li>提取完成後可下載 JSON 或上傳到 API。</li>
          </ol>
        </div>
      </div>

    </div>
    <div class="tab-pane fade" id="settings" role="tabpanel">

      <!-- 排程總開關 -->
      <div class="card mb-3">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <strong>啟用自動排程</strong>
              <div class="small text-muted">開啟後將在背景自動執行提取和上傳</div>
            </div>
            <div class="form-check form-switch">
              <input class="form-check-input" type="checkbox" id="scheduleMainSwitch">
            </div>
          </div>
        </div>
      </div>

      <!-- 排程列表 -->
      <div class="mb-2">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <strong>排程列表</strong>
          <button id="addScheduleBtn" class="btn btn-sm btn-main">+ 新增排程</button>
        </div>
        <div id="scheduleList" class="schedule-list">
          <!-- 排程項目會動態插入這裡 -->
        </div>
      </div>

      <!-- 新增/編輯排程表單 (預設隱藏) -->
      <div id="scheduleForm" class="card mb-3" style="display: none;">
        <div class="card-body">
          <h6 class="mb-2">排程設定</h6>

          <div class="mb-2">
            <label class="form-label small">排程名稱</label>
            <input type="text" id="scheduleName" class="form-control form-control-sm" placeholder="例: 每日定時提取">
          </div>

          <div class="mb-2">
            <label class="form-label small">設定方式</label>
            <div class="btn-group w-100" role="group">
              <input type="radio" class="btn-check" name="scheduleMode" id="modeSimple" value="simple" checked>
              <label class="btn btn-outline-primary btn-sm" for="modeSimple">簡易模式</label>

              <input type="radio" class="btn-check" name="scheduleMode" id="modeCron" value="cron">
              <label class="btn btn-outline-primary btn-sm" for="modeCron">Cron 模式</label>
            </div>
          </div>

          <!-- 簡易模式 -->
          <div id="simpleModePanel">
            <div class="mb-2">
              <label class="form-label small">執行時間</label>
              <input type="time" id="scheduleTime" class="form-control form-control-sm" value="09:00">
            </div>

            <div class="mb-2">
              <label class="form-label small">執行日期</label>
              <div class="day-selector">
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="checkbox" id="day0" value="0">
                  <label class="form-check-label" for="day0">日</label>
                </div>
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="checkbox" id="day1" value="1" checked>
                  <label class="form-check-label" for="day1">一</label>
                </div>
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="checkbox" id="day2" value="2" checked>
                  <label class="form-check-label" for="day2">二</label>
                </div>
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="checkbox" id="day3" value="3" checked>
                  <label class="form-check-label" for="day3">三</label>
                </div>
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="checkbox" id="day4" value="4" checked>
                  <label class="form-check-label" for="day4">四</label>
                </div>
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="checkbox" id="day5" value="5" checked>
                  <label class="form-check-label" for="day5">五</label>
                </div>
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="checkbox" id="day6" value="6">
                  <label class="form-check-label" for="day6">六</label>
                </div>
              </div>
            </div>
          </div>

          <!-- Cron 模式 -->
          <div id="cronModePanel" style="display: none;">
            <div class="mb-2">
              <label class="form-label small">Cron 表達式</label>
              <input type="text" id="cronExpression" class="form-control form-control-sm" placeholder="0 9 * * 1-5">
              <div class="form-text">格式: 分 時 日 月 週 (例: 0 9 * * 1-5 = 週一至週五 9:00)</div>
            </div>
            <div id="cronDescription" class="small text-muted mb-2"></div>
          </div>

          <div class="d-flex gap-2">
            <button id="saveScheduleBtn" class="btn btn-sm btn-main flex-fill">儲存</button>
            <button id="cancelScheduleBtn" class="btn btn-sm btn-aux">取消</button>
          </div>
        </div>
      </div>

      <!-- 執行歷史 -->
      <div class="card">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <strong>最近執行記錄</strong>
            <button id="clearHistoryBtn" class="btn btn-sm btn-aux"
              style="padding: 2px 8px; font-size: 0.75rem;">清除</button>
          </div>
          <div id="executionHistory" class="execution-history">
            <!-- 執行記錄會動態插入這裡 -->
          </div>
        </div>
      </div> 
    </div>
  </div>

  <script src="vendor/bootstrap.bundle.min.js"></script>
  <!-- 載入所有 JavaScript 模組 -->
  <script src="config.js"></script>
  <script src="storage.js"></script>
  <script src="ui.js"></script>
  <script src="api.js"></script>
  <script src="extractor.js"></script>
  <script src="scheduler.js"></script>
  <script src="popup.js"></script>
  <script src="popup-scheduler.js"></script>
</body>

</html>